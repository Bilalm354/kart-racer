{"id":"../node_modules/graphql-tools/dist/stitching/delegateToSchema.js","dependencies":[{"name":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js.map","includedInParent":true,"mtime":499162500000},{"name":"/Users/bilal/Projects/kart-racer/server/package.json","includedInParent":true,"mtime":1610848218647},{"name":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/package.json","includedInParent":true,"mtime":1602017675708},{"name":"graphql","loc":{"line":45,"column":24},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql/index.mjs"},{"name":"../transforms/transforms","loc":{"line":46,"column":27},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/transforms.js"},{"name":"../transforms/AddArgumentsAsVariables","loc":{"line":47,"column":40},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/AddArgumentsAsVariables.js"},{"name":"../transforms/FilterToSchema","loc":{"line":48,"column":31},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/FilterToSchema.js"},{"name":"../transforms/AddTypenameToAbstract","loc":{"line":49,"column":38},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/AddTypenameToAbstract.js"},{"name":"../transforms/CheckResultAndHandleErrors","loc":{"line":50,"column":43},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/CheckResultAndHandleErrors.js"},{"name":"./mapAsyncIterator","loc":{"line":51,"column":33},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/mapAsyncIterator.js"},{"name":"../transforms/ExpandAbstractTypes","loc":{"line":52,"column":36},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/ExpandAbstractTypes.js"},{"name":"../transforms/ReplaceFieldWithFragment","loc":{"line":53,"column":41},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/ReplaceFieldWithFragment.js"},{"name":"../transforms/ConvertEnumResponse","loc":{"line":54,"column":36},"parent":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/stitching/delegateToSchema.js","resolved":"/Users/bilal/Projects/kart-racer/server/node_modules/graphql-tools/dist/transforms/ConvertEnumResponse.js"}],"generated":{"js":"var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar graphql_1 = require(\"graphql\");\nvar transforms_1 = require(\"../transforms/transforms\");\nvar AddArgumentsAsVariables_1 = require(\"../transforms/AddArgumentsAsVariables\");\nvar FilterToSchema_1 = require(\"../transforms/FilterToSchema\");\nvar AddTypenameToAbstract_1 = require(\"../transforms/AddTypenameToAbstract\");\nvar CheckResultAndHandleErrors_1 = require(\"../transforms/CheckResultAndHandleErrors\");\nvar mapAsyncIterator_1 = require(\"./mapAsyncIterator\");\nvar ExpandAbstractTypes_1 = require(\"../transforms/ExpandAbstractTypes\");\nvar ReplaceFieldWithFragment_1 = require(\"../transforms/ReplaceFieldWithFragment\");\nvar ConvertEnumResponse_1 = require(\"../transforms/ConvertEnumResponse\");\nfunction delegateToSchema(options) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    if (options instanceof graphql_1.GraphQLSchema) {\n        throw new Error('Passing positional arguments to delegateToSchema is a deprecated. ' +\n            'Please pass named parameters instead.');\n    }\n    return delegateToSchemaImplementation(options);\n}\nexports.default = delegateToSchema;\nfunction delegateToSchemaImplementation(options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var info, _a, args, operation, rawDocument, rawRequest, transforms, processedRequest, errors, _b, executionResult;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    info = options.info, _a = options.args, args = _a === void 0 ? {} : _a;\n                    operation = options.operation || info.operation.operation;\n                    rawDocument = createDocument(options.fieldName, operation, info.fieldNodes, Object.keys(info.fragments).map(function (fragmentName) { return info.fragments[fragmentName]; }), info.operation.variableDefinitions, info.operation.name);\n                    rawRequest = {\n                        document: rawDocument,\n                        variables: info.variableValues,\n                    };\n                    transforms = __spreadArrays((options.transforms || []), [\n                        new ExpandAbstractTypes_1.default(info.schema, options.schema),\n                    ]);\n                    if (info.mergeInfo && info.mergeInfo.fragments) {\n                        transforms.push(new ReplaceFieldWithFragment_1.default(options.schema, info.mergeInfo.fragments));\n                    }\n                    transforms = transforms.concat([\n                        new AddArgumentsAsVariables_1.default(options.schema, args),\n                        new FilterToSchema_1.default(options.schema),\n                        new AddTypenameToAbstract_1.default(options.schema),\n                        new CheckResultAndHandleErrors_1.default(info, options.fieldName),\n                    ]);\n                    if (graphql_1.isEnumType(options.info.returnType)) {\n                        transforms = transforms.concat(new ConvertEnumResponse_1.default(options.info.returnType));\n                    }\n                    processedRequest = transforms_1.applyRequestTransforms(rawRequest, transforms);\n                    if (!options.skipValidation) {\n                        errors = graphql_1.validate(options.schema, processedRequest.document);\n                        if (errors.length > 0) {\n                            throw errors;\n                        }\n                    }\n                    if (!(operation === 'query' || operation === 'mutation')) return [3 /*break*/, 2];\n                    _b = transforms_1.applyResultTransforms;\n                    return [4 /*yield*/, graphql_1.execute(options.schema, processedRequest.document, info.rootValue, options.context, processedRequest.variables)];\n                case 1: return [2 /*return*/, _b.apply(void 0, [_c.sent(),\n                        transforms])];\n                case 2:\n                    if (!(operation === 'subscription')) return [3 /*break*/, 4];\n                    return [4 /*yield*/, graphql_1.subscribe(options.schema, processedRequest.document, info.rootValue, options.context, processedRequest.variables)];\n                case 3:\n                    executionResult = (_c.sent());\n                    // \"subscribe\" to the subscription result and map the result through the transforms\n                    return [2 /*return*/, mapAsyncIterator_1.default(executionResult, function (result) {\n                            var _a;\n                            var transformedResult = transforms_1.applyResultTransforms(result, transforms);\n                            var subscriptionKey = Object.keys(result.data)[0];\n                            // for some reason the returned transformedResult needs to be nested inside the root subscription field\n                            // does not work otherwise...\n                            return _a = {},\n                                _a[subscriptionKey] = transformedResult,\n                                _a;\n                        })];\n                case 4: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction createDocument(targetField, targetOperation, originalSelections, fragments, variables, operationName) {\n    var selections = [];\n    var args = [];\n    originalSelections.forEach(function (field) {\n        var fieldSelections = field.selectionSet\n            ? field.selectionSet.selections\n            : [];\n        selections = selections.concat(fieldSelections);\n        args = args.concat(field.arguments || []);\n    });\n    var selectionSet = null;\n    if (selections.length > 0) {\n        selectionSet = {\n            kind: graphql_1.Kind.SELECTION_SET,\n            selections: selections,\n        };\n    }\n    var rootField = {\n        kind: graphql_1.Kind.FIELD,\n        alias: null,\n        arguments: args,\n        selectionSet: selectionSet,\n        name: {\n            kind: graphql_1.Kind.NAME,\n            value: targetField,\n        },\n    };\n    var rootSelectionSet = {\n        kind: graphql_1.Kind.SELECTION_SET,\n        selections: [rootField],\n    };\n    var operationDefinition = {\n        kind: graphql_1.Kind.OPERATION_DEFINITION,\n        operation: targetOperation,\n        variableDefinitions: variables,\n        selectionSet: rootSelectionSet,\n        name: operationName,\n    };\n    return {\n        kind: graphql_1.Kind.DOCUMENT,\n        definitions: __spreadArrays([operationDefinition], fragments),\n    };\n}\n"},"sourceMaps":{"js":{"version":3,"file":"delegateToSchema.js","sourceRoot":"","sources":["../../src/stitching/delegateToSchema.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"65127f29f1d36b8f50e7172a8a2fa880","cacheData":{"env":{}}}